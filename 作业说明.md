# Java 程序设计课程设计说明文档

贺梓淇 18373263 180621班

最近更新日期：2019 年 11 月 07 日

## 软件功能说明：

本软件可以帮助您预览和编辑 Markdown 格式的文件，您不仅可以使用此软件将 Markdown 文件转换为其它格式，还能拥有具有高度扩展性的自定义工作区

### 主要功能：

1. 编辑并实时预览 Markdown 文件
2. 提供文档的字数、最近保存时间信息
3. 您可以使用快捷键进行快速打开、新建文档，查看帮助等操作
4. 将 Markdown 格式的 `.md` 文件转换为 `.txt / .html` 文件
5. 提供仅显示编辑区 / 预览区的选项
6. 同步滑动编辑器界面与预览窗口
7. 自动保存文档
8. 提供多种预览/编辑器主题、文字样式可供选择
9. 使用用户自定义的个性化主题（自定义主题格式要求见[自定义样式文档]( https://github.com/APassbyDreg/MarkdownEditTool/blob/master/doc/Customize_Themes_Instructions.md)）
10. 自动关闭重要性较低的提示框
11. 记录并储存您的文件使用历史并在下次打开软件时显示
12. 帮助文档索引

### 目前支持的 Markdown 语法：

- 有序 / 无序列表
- 引用
- 行内代码 / 代码块
- 加粗与斜体
- 水平分割线
- 六种标题
- 超链接
- 图片显示

### 快捷键列表：

- 标题界面：
  - `ctrl + N` 新建文档
  - `ctrl + O` 打开文档
  - `ctrl + H` 打开帮助界面
- 编辑界面：
  - `ctrl + N` 新建文档
  - `ctrl + O` 打开文档
  - `ctrl + S` 保存文档
  - `ctrl + Q` 关闭文档
  - `ctrl + R` 回到标题界面
  - `ctrl + P` 打开/关闭仅显示预览
  - `ctrl + E` 打开/关闭仅显示编辑器
  - `ctrl + alt + H` 打开帮助界面
  - `ctrl + alt + S` 另存文档为新 Markdown 文件
  - `alt + F` 打开文件菜单
  - `alt + E` 打开编辑器菜单
  - `alt + L` 打开外观设置菜单
  - `alt + H` 打开帮助菜单
- 帮助界面
  - `ctrl + alt + C` 复制帮助页面的链接

### 文件依赖项：

本软件在初次运行时会在 `Main.class` （编译运行）或 `MarkdownEditTool.jar` （直接运行 jar）的同目录下新建 `resources, tmp` 目录保存用户设置、主题与临时文件，目录树如下：

```
- resources
  - themes
    - light(default).css
    - dark.css
    - page.css
  - UserSettings.config
  - README.md
- tmp
- MarkdownEditTool.jar / Main.class
```

**注意**：由于程序使用文件名识别根目录，请在使用时不要改变 `.jar` 文件的文件名

### 目前已知的问题：

- 当文件在被打开但未修改的状态下，预览可能出现忽略换行的问题
- 内置的 `README.md` 中的汉字会在从 `jar` 包中导出时出现乱码

## 软件设计思路

### 总体结构：

为了实现本软件的功能，我设计了三个处理层次，分别放入了 `File, Convert, GUI` 三个包中。 `File` 负责处理与文件交互相关的事件；`Convert` 负责主要功能 “Markdown to HTML” 的实现；`GUI` 负责显示图形界面与相应用户操作

用户输入在被 `GUI` 读入后，经由 `Convert` 类先转换为 HTML 格式的字符串传回 `GUI` 显示为具有样式的预览，同时信息会被储存于 `File` 中，等待保存。

### GUI 包的结构：

由于 Java 的 awt 与 swing 实在是太丑了，本程序中主要采用了 JavaFX 作为 GUI 的底层，通过 FXML 与 CSS 控制程序的外观。

GUI 包中有三个类，分别作为欢迎页的事件处理类 `IntroPageControler` 、编辑页的事件处理类 `EditPageController` 与另外三种提醒信息类

### Convert 包的结构：

`Convert` 包的主类是 `Converter` ，这个类扩展了 `BlockBuilder` 类，包含了将 Markdown 文件转换为 HTML 文件的主要函数与处理方法。

Markdown 转 HTML 的主要逻辑如下：

1. `Converter` 类逐行读入 Markdown 字符串并区分出行内块（如加粗、行内代码等）与跨行块（代码块、列表等）
2. `Converter` 类将 Markdown 文件分割出的多个块进行预处理，提出有效的字符串并发送给 `BlockBuilder` 类的函数
3. `BlockBuilder` 类接受预处理后的字符串，转换为 `BlockInfo` 类的数据，以此生成 HTML 格式的字符串并返回给 `Converter` 类
4. `Converter` 类将各类数据汇总，添加 HTML 的头部信息，补全语法，生成完整的 HTML 字符串

### File 包的结构：

`FileInfo` 类是 `File` 包中的基础类，它是本包中另外三个类的超类，其中包含了各种文件操作的方法与文件的各种信息

`MarkdownFile` 类扩展了 `FileInfo` 类，添加了操作 Markdown 文件内容的特殊方法

`WebFile` 类扩展了 `FileInfo` 类，添加了操作 HTML 文件内容的特殊方法

`ProgramInfo` 类扩展了 `FileInfo` 类，负责储存用户的设置数据，添加了程序初始化、用户设置存取的特殊方法

### Global 包与 Global 类

`Global` 类中储存了程序的基础信息，包括临时文件夹位置、资源位置、`.jar` 包名等信息，便于其它类读取